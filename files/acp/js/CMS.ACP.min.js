if(!CMS)var CMS={};CMS.ACP={};CMS.ACP.Page={};CMS.ACP.Page.AddForm=Class.extend({init:function(){$("#alias, #parentID").change($.proxy(this._buildAliasPreview,this));this._buildAliasPreview()},_buildAliasPreview:function(){var b=$("#parentID option:selected").data("alias"),c=$("#alias").val(),a="";if(c!=""){a="index.php/";if(b!=""&&typeof b!=="undefined")a+=b+"/";a+=c+"/";$("#aliasPreview").html(WCF.Language.get("cms.acp.page.alias.preview")+" "+a).show()}else $("#aliasPreview").hide()}});CMS.ACP.Page.Menu=Class.extend({init:function(){$("#menuItemParameters").change($.proxy(this._showNotice,this));$("#menuItemController").change($.proxy(this._showNotice,this));$("#menuItemParametersContainer > dd").append('<p id="cmsNoticeContainer" />');this._showNotice()},_showNotice:function(){if($("#menuItemController").val()=="cms\\page\\PagePage")$("#cmsNoticeContainer").html("<small>"+WCF.Language.get("wcf.acp.pageMenu.parameters.notice")+"</small>");else $("#cmsNoticeContainer").html("")}}),CMS.ACP.Page.AddContent=Class.extend({_proxy:null,_cache:{},_dialog:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".jsContentAddButton").click($.proxy(this._click,this))},_click:function(b){b.preventDefault();var a=$(b.currentTarget);this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[a.data("objectID")],parameters:{position:a.data("position"),parentID:a.data("parentID")}});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="contentAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.acp.content.add")})},_success:function(a){this._cache[a.returnValues.pageID]=a.returnValues.template;this._show(a.returnValues.pageID)}});CMS.ACP.File={};CMS.ACP.File.Details=Class.extend({_cache:{},_didInit:false,_proxy:null,init:function(){if(!this._didInit){this._didInit=true;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});WCF.DOMNodeInsertedHandler.addCallback("CMS.ACP.File.Details",$.proxy(this.init,this))}$(".jsFileDetails:not(.jsFileDetailsEnabled)").addClass("jsFileDetailsEnabled").click($.proxy(this._click,this))},_click:function(b){var a=$(b.currentTarget).data("fileID");if(this._cache[a]===undefined){this._proxy.setOption("data",{actionName:"getDetails",className:"cms\\data\\file\\FileAction",objectIDs:[a]});this._proxy.sendRequest()}else this._cache[a].wcfDialog("open")},_success:function(a){this._cache[a.returnValues.fileID]=$(a.returnValues.template).hide().appendTo("body");this._cache[a.returnValues.fileID].wcfDialog({title:a.returnValues.title})}});CMS.ACP.File.Picker=Class.extend({_currentlyOpenCategory:0,_dialog:null,_inputName:"",_options:null,_proxy:null,_selectButton:null,_selected:null,init:function(c,d,b,e){this._selectButton=c;this._inputName=d;this._selected=b||[];this._options=$.extend(true,{multiple:false,fileType:""},e);this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});var a=this._selectButton.parents("form");if(!a.length){console.log("[CMS.ACP.File.Picker] Unable to determine form for file picker, aborting.");return}a.submit($.proxy(this._submit,this));this._selectButton.click($.proxy(this._openPicker,this))},selectFiles:function(b,d){if(!this._options.multiple&&b.length>1){console.log("[CMS.ACP.File.Picker] Selection of more than one file is not allowed, aborting.");return}for(var a,c=0,e=b.length;c<e;c++){a=b[c];if(this._selected.indexOf(a)!==-1){this._selected.push(a);d!==false&&this._dialog.find('tr[data-file-id="'+a+'"]').find("input").prop("checked",true)}}},_dropdownCategoryClick:function(b){var a=$(b.currentTarget).data("categoryID");this._openCategory(a)},_inputClick:function(c){var a=$(c.currentTarget);if(a.is(":checked"))this._selected.push(a.val());else{var b=$.inArray(a.val(),this._selected);this._selected.splice(b,1)}},_openCategory:function(a){var b=this._dialog.find('.tabularBox[data-category-id="'+a+'"]');if(b.length){this._currentlyOpenCategory=a;this._dialog.find(".tabularBox").hide();b.show();$dropdownMenu=WCF.Dropdown.getDropdownMenu($(".filePickerCategoryDropdown").wcfIdentify());$dropdownMenu.find("li.active").removeClass("active");$dropdownMenu.find('li[data-category-id="'+a+'"]').addClass("active");this._dialog.wcfDialog("render")}else{this._proxy.setOption("data",{actionName:"getFileList",className:"cms\\data\\file\\FileAction",parameters:{categoryID:a,fileType:this._options.fileType}});this._proxy.sendRequest()}},_openPicker:function(){if(this._dialog===null){this._proxy.setOption("data",{actionName:"getFileList",className:"cms\\data\\file\\FileAction",parameters:{fileType:this._options.fileType}});this._proxy.sendRequest()}else this._dialog.wcfDialog("open")},_reload:function(){this._dialog.find(".tabularBox").remove();this._openCategory(this._currentlyOpenCategory)},_submit:function(e){var c=$(e.currentTarget);if(this._options.multiple)for(var a=0,d=this._selected.length;a<d;a++){var b=this._selected[a];$('<input type="hidden" name="'+this._inputName+'[]" value="'+b+'" />').appendTo(c)}else{var b=this._selected.pop();$('<input type="hidden" name="'+this._inputName+'" value="'+b+'" />').appendTo(c)}},_success:function(a){if(this._dialog===null){this._dialog=$(a.returnValues.template).hide();this._dialog.find(".filePickerCategoryDropdown li").click($.proxy(this._dropdownCategoryClick,this));this._currentlyOpenCategory=a.returnValues.categoryID;this._dialog.appendTo("body");this._dialog.wcfDialog({title:a.returnValues.title});CMS.ACP.File.Upload.init($.proxy(this._uploadCallback,this))}else{$(a.returnValues.template).hide().appendTo(this._dialog);this._openCategory(a.returnValues.categoryID)}this._dialog.find("td.columnMark").each($.proxy(function(e,d){var c=$(d),b=c.parent().data("fileID"),a;if(this._options.multiple)a=$('<input type="checkbox" name="'+this._inputName+'Picker[]" value="'+b+'" />').appendTo(c);else a=$('<input type="radio" name="'+this._inputName+'Picker" value="'+b+'" />').appendTo(c);WCF.inArray(b,this._selected)&&a.prop("checked",true);a.click($.proxy(this._inputClick,this))},this))},_uploadCallback:function(a){(this._options.multiple||a.length==1)&&this.selectFiles(a,false);this._reload()}});CMS.ACP.File.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".cmsFileLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false})},_loadContent:function(){var b=$("#"+this._activeElementID);this._proxy.setOption("data",{actionName:"getFilePreview",className:"cms\\data\\file\\FileAction",objectIDs:[b.data("fileID")]});var a=this._activeElementID,c=this;this._proxy.setOption("success",function(b){c._insertContent(a,b.returnValues.template,true)});this._proxy.sendRequest()}});CMS.ACP.File.Upload={_afterSubmit:null,_categoryInput:null,_dialog:null,_fileIDs:null,_proxy:null,_submitButton:null,init:function(a){this._afterSubmit=a||null;this._fileIDs=[];this._proxy=new WCF.Action.Proxy;$(".jsFileUploadButton").click($.proxy(this._openDialog,this))},addFile:function(a){this._fileIDs.push(a);this._handleButtonState()},redraw:function(){this._dialog!==null&&this._dialog.wcfDialog("render")},_finalizeUpload:function(b){b.preventDefault();if(!this._fileIDs.length){console.log("[CMS.ACP.File.Upload] Tried to finalize upload though no files where uploaded, aborting.");return}var a=this._categoryInput.val();if(a===null){console.log("[CMS.ACP.File.Upload] Tried to finalize upload without a selected category, aborting.");return}this._submitButton.attr("disabled","disabled");this._proxy.setOption("data",{actionName:"update",className:"cms\\data\\file\\FileAction",objectIDs:this._fileIDs,parameters:{categoryIDs:a}});this._proxy.setOption("success",$.proxy(function(){this._dialog.wcfDialog("close");new WCF.PeriodicalExecuter($.proxy(function(a){this._dialog.parents(".dialogContainer").remove();this._dialog=null;a.stop()},this),200);$.isFunction(this._afterSubmit)&&this._afterSubmit(this._fileIDs)},this));this._proxy.sendRequest()},_handleButtonState:function(){if(!this._fileIDs.length){this._submitButton.attr("disabled","disabled");return}if(this._categoryInput.val()===null){this._submitButton.attr("disabled","disabled");return}this._submitButton.removeAttr("disabled")},_openDialog:function(){if(this._dialog===null){this._proxy.setOption("data",{actionName:"getUploadDialog",className:"cms\\data\\file\\FileAction"});this._proxy.setOption("success",$.proxy(this._openDialogResponse,this));this._proxy.sendRequest()}else this._dialog.wcfDialog("render")},_openDialogResponse:function(a){this._dialog=$(a.returnValues.template).hide().appendTo("body");this._categoryInput=$("#categoryIDs");this._categoryInput.change($.proxy(this._handleButtonState,this));this._submitButton=$("#fileUploadSubmitButton");this._submitButton.click($.proxy(this._finalizeUpload,this));new CMS.ACP.File.Upload.Handler;this._dialog.wcfDialog({title:a.returnValues.title})}};CMS.ACP.File.Upload.Handler=WCF.Upload.Parallel.extend({init:function(){this._super($("#fileUploadButton"),$(".fileUpload ul"),"cms\\data\\file\\FileAction")},_error:function(c,b,a){console.log(c,b,a)},_initFile:function(a){$li=$('<li class="box32"><span class="icon icon32 icon-spinner" /><div><div><p>'+a.name+'</p><small><progress max="100"></progress></small></div></div></li>').appendTo(this._fileListSelector);CMS.ACP.File.Upload.redraw();return $li},_success:function(b,c){var a=this._uploadMatrix[b];a.find("progress").remove();if(c.returnValues.files[b]){var e=c.returnValues.files[b];CMS.ACP.File.Upload.addFile(e.fileID);a.children(".icon-spinner").removeClass("icon-spinner").addClass("icon-paperclip");a.find("small").append(e.formattedFilesize)}else{var d="uploadFailed";if(c.returnValues.errors[b])d=c.returnValues.errors[b].errorType;a.children(".icon-spinner").removeClass("icon-spinner").addClass("icon-ban-circle");a.find("div > div").append($('<small class="innerError">'+WCF.Language.get("cms.acp.file.error."+d)+"</small>"));a.addClass("uploadFailed")}a.css("display","block");CMS.ACP.File.Upload.redraw();WCF.DOMNodeInsertedHandler.execute()}});CMS.ACP.Image={};CMS.ACP.Image.Ratio=Class.extend({_ratio:1,init:function(b,a){this._ratio=b/a;$("#width").change($.proxy(this._calculateHeight,this));$("#height").change($.proxy(this._calculateWidth,this))},_calculateHeight:function(){var a=$("#width"),b=a.val()/this._ratio;$("#height").val(Math.round(b))},_calculateWidth:function(){var a=$("#height"),b=a.val()*this._ratio;$("#width").val(Math.round(b))}});CMS.ACP.Page.Revisions=Class.extend({_proxy:null,_cache:{},_dialog:null,_didInit:false,init:function(){if(this._didInit)return;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._buttons=$(".jsRevisionsButton");this._buttons.click($.proxy(this._click,this));new WCF.Action.Delete("cms\\data\\page\\revision\\PageRevisionAction",".jsRevisionRow");this._didInit=true},_click:function(a){a.preventDefault();var b=$(a.currentTarget).data("objectID");this._proxy.setOption("data",{actionName:"getRevisions",className:"cms\\data\\page\\PageAction",objectIDs:[b]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="revisionDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.acp.page.revision.list")})},_success:function(a){this._cache[a.returnValues.pageID]=a.returnValues.template;this._show(a.returnValues.pageID)}});CMS.ACP.Page.Revisions.Restore=Class.extend({_proxy:null,_didInit:false,init:function(){if(this._didInit)return;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._buttons=$(".jsRestoreRevisionButton");this._buttons.click($.proxy(this._click,this));this._didInit=true},_click:function(b){b.preventDefault();var a=$(b.currentTarget);if(a.data("confirmMessage"))WCF.System.Confirmation.show(a.data("confirmMessage"),$.proxy(this._execute,this),{target:a});else{WCF.LoadingOverlayHandler.updateIcon(a);this._sendRequest(a)}},_sendRequest:function(a){$versionID=$(a).data("objectID");this._proxy.setOption("data",{actionName:"restore",className:"cms\\data\\page\\revision\\PageRevisionAction",objectIDs:[$versionID]});this._proxy.sendRequest()},_execute:function(b,a){if(b==="cancel")return;WCF.LoadingOverlayHandler.updateIcon(a.target);this._sendRequest(a.target)},_success:function(){var a=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));a.show(function(){window.location=location})}})